---
title: "Holocene biomes dynamic"
author: "Vincent Pellissier"
date: "29 août 2018"
output: html_document
---

# Spatial dynamic of the biomes through the Holocene

While organizing a workshop on the impact of human activities on biodiversity at different spatial
scales, I realized that a good entry point would be to illustrate how some physical features of
the environment (for example biome area, as defined as the area of a biome not being covered by land-use) 
have changed through time.

## The historical land-use dataset
The HYDE 3.2 dataset is a well-known reconstruction of past land-use (from the beginning of the Holocene to present day). For each time point the percentage of each cell being cropland (divided into irrigated and rain-fed non-rice crops and irrigated and rain-fed rice crops) or grazing land (divided into intensive pasture and less intensive rangeland) is modelled based on population estimates. The whole data set comprises 67 series of maps: for each time point, a map for each of the above land-cover was produced. In addition, at each time point, three different population estimate are used (lower, median and upper)

## Outputs
I had two visual outputs in mind. (1) A temporal graph of the total area for each simplified biomes (Boreal forests, Temperate forests, Tropical forests, Temperate grasslands, Tropical grasslands, Desert and Other biomes) and (2) a series of chronological maps showing the variation of the extant of each biome through time

## Methods
### Downloading and extracting maps
On the HYDE website, maps are downloadable either one by one (that is, for each point in time, one has to select the desired population scenario, format, date and type of land-cover) or in bulk (that is, on .zip file per date).
Neither of these options is really practical. The first one implies clicking on each map, one by one. The second one implies extracting the maps from the zipfile, either one by one, or autocmatically (and having more information that is really needed).
To overcome that issue, I designed a function (compute_non_human()) that computes for a given point in time and for each biome, the percentage of each cell NOT covered by a human land-cover (i.e. cropland and grazing land) and saves it on a local computer.  

#### Download and computation algorithm
The code in the function is commented, but what follow is a brief description of the algorithm and the code used to run the function:

* The function takes several arguments:
    + 'date' is the date for which we want information,  
    + 'scenario' matches the population scenario ('upper', 'lower' or 'median')  
    + 'path_save' is the local path where the maps are saved    
    + raster_biomes' is a  raster containing biome information. It matches the biomes shapefile found             [here](https://www.worldwildlife.org/publications/terrestrial-ecoregions-of-the-world). The biomes raster can be downloaded [here](https://github.com/vpellissier/holocene_biomes_dynamic/raw/master/Original%20data/biomes.tif)
    
  
* The function proceed as follow:  
    + It calls a subfunction (dl_land_use()) which download a raster of a land-cover for a given date in a temporary folder This sub-function is called three time (to download raster for cropland, rangeland and pastures). This webscrapping approach requires one extra-step, explained in more detail below.
    + The 3 rasters are loaded in the R environment and added together, in order to create a human land-cover layer.
    + For each given biome in the raster, the percentage of each cell belonging to this biome and NOT being human land-cover is computed.
    + The output is saved as a stacked raster (one layer per biome) and the temporary folder is removed from the local computer
    
#### Example
First, one need to download the biome raster in a folder (here, I use a temporary folder) and the accompanying XML file.

```{r eval = FALSE}
library(raster)
tp <- tempdir()
raster_url <- "https://github.com/vpellissier/holocene_biomes_dynamic/raw/master/Original%20data/biomes.tif"
xml_url <- "https://github.com/vpellissier/holocene_biomes_dynamic/raw/master/Original%20data/biomes.tif.aux.xml"
download.file(raster_url, file.path(tp, "biomes.tif"), mode = "wb")
download.file(xml_url, file.path(tp, "biomes.tif.aux.xml"), mode = "wb")
raster_biome <- raster(file.path(tp, "biomes.tif"))
```
    
Then, maps are downloaded and computed for the 66 dates available in the HYDE dataset (unfortunately, dates had to be copied manually).
```{r eval = FALSE}
dates <- c("10000BC", "9000BC", "8000BC", "7000BC", "6000BC", "5000BC", "4000BC", "3000BC",
           "2000BC", "1000BC", "0AD", "500AD", "1000AD", "1100AD", "1200AD", "1300AD", "1400AD", 
           "1500AD", "1600AD", "1700AD", "1710AD", "1720AD", "1730AD",   "1740AD", "1750AD", 
           "1760AD", "1770AD", "1780AD", "1790AD", "1800AD", "1810AD", "1820AD", "1840AD", 
           "1850AD", "1860AD", "1870AD", "1880AD", "1890AD", "1900AD", "1910AD", "1920AD", 
           "1930AD", "1940AD", "1950AD", "1960AD", "1970AD", "1980AD", "1990AD", "2000AD", 
           "2001AD", "2002AD", "2003AD", "2004AD", "2005AD", "2006AD", "2007AD", "2008AD", 
           "2009AD", "2010AD", "2011AD", "2012AD", "2013AD", "2014AD", "2015AD", "2016AD")

for(time_point in dates){
        try(compute_non_human(date, "upper", 
                      raster_biome, 
                      save_path = "your_path_here"))
}
```
